; PlatformIO Project Configuration File
;
;   Build options: build flags, source filter
;   Upload options: custom upload port, speed and extra flags
;   Library options: dependencies, extra library storages
;   Advanced options: extra scripting
;
; Please visit documentation for the other options and examples
; https://docs.platformio.org/page/projectconf.html


[env:esp32-s3-devkitc-1-psram]
board_build.arduino.memory_type = qio_opi  ; NEEDED FOR 8MB PSRAM (N16R8)
;board_build.partitions = custom_16Mb.csv
;board_upload.flash_size = 16MB
;monitor_speed = 115200
;board_build.partitions = custom_16Mb.csv
;board_build.f_flash = 40000000L
;board_upload.flash_size = 16MB
;board_upload.maximum_size = 16777216
;board_build.f_flash = 40000000L
;board_build.flash_mode = qio
extends                 = env:esp32-s3-devkitc-1


[env:esp32-s3-devkitc-1]
; pakai variant kita sendiri
board = ESP-General
board_build.partitions = custom_8Mb.csv
build_src_filter = ${env.build_src_filter} +<../boards/ESP-General>

build_flags =
    ${env.build_flags}
    -Iboards/ESP-General
    -DUSB_as_HID=1

    ; ===== Grove / header GPIO =====
    ; GEEK: pakai SDA=8, SCL=9 (atau 46 kalau kamu mau ikuti default lama)
    -DGROVE_SDA=8
    -DGROVE_SCL=9
    ;-DALLOW_ALL_GPIO_FOR_IR_RF=1

    ; ===== IR LED / RX (semua via Grove) =====
    -DIR_TX_PINS='{{"Grove W", GROVE_SCL}, {"Grove Y", GROVE_SDA}}'
    -DIR_RX_PINS='{{"Grove W", GROVE_SCL}, {"Grove Y", GROVE_SDA}}'

    ; Tidak ada LED onboard
    -DTXLED=-1
    -DLED_ON=HIGH
    -DLED_OFF=LOW

    ; ===== RF433 (satu pin) =====
    -DRF_TX_PINS='{{"Grove W", GROVE_SCL}, {"Grove Y", GROVE_SDA}}'
    -DRF_RX_PINS='{{"Grove W", GROVE_SCL}, {"Grove Y", GROVE_SDA}}'

    ; ===== SD card: pakai SPI di pins_arduino.h (CS=21, SCK=12, MISO=13, MOSI=11) =====
    -DSDCARD_CS=21
    -DSDCARD_SCK=12
    -DSDCARD_MISO=13
    -DSDCARD_MOSI=11

    ; ===== TFT / LCD bawaan GEEK (ST7789 1.14") =====
    -DROTATION=1
    -DBACKLIGHT=7        ; LCD_BL = GPIO7
    -DMINBRIGHT=160
    -DSMOOTH_FONT=1
    -DTFT_DISPON=0x29
    -DTFT_DISPOFF=0x28
    -DTFT_CS=10          ; LCD_CS
    -DTFT_DC=8           ; LCD_DC
    -DTFT_RST=9          ; LCD_RST
    -DTOUCH_CS=-1        ; tidak ada touch
    -DTFT_MOSI=11        ; MOSI
    -DTFT_SCLK=12        ; SCK
    -DTFT_BL=7           ; backlight

    ; text sizes
    -DFP=1
    -DFM=2
    -DFG=3

    ; ui control buttons (tidak ada, biarkan default)
    ;-DSEL_BTN=1
    ;-DUP_BTN=2
    ;-DDW_BTN=3
    -DBTN_ALIAS='"OK"'

    ; ===== FM Radio (opsional) =====
    ;-DFM_SI4713=1
    -DFM_RSTPIN=12

    ; ===== Microphone (tidak ada di GEEK, biarkan -1) =====
    ;-DMIC_SPM1423=1
    ;-DPIN_CLK=-1
    ;-DI2S_SCLK_PIN=-1
    ;-DI2S_DATA_PIN=-1
    ;-DPIN_DATA=-1

    ; ===== CC1101 via SPI (pakai bus yang sama dengan LCD/TF) =====
    -DUSE_CC1101_VIA_SPI
    -DCC1101_GDO0_PIN=9
    -DCC1101_SS_PIN=10
    -DCC1101_MOSI_PIN=11
    -DCC1101_SCK_PIN=12
    -DCC1101_MISO_PIN=13
    ;-DCC1101_GDO2_PIN=14

    ; ===== SPI alias global =====
    -DSPI_SCK_PIN=12
    -DSPI_MOSI_PIN=11
    -DSPI_MISO_PIN=13
    -DSPI_SS_PIN=10

    ; Nama device
    -DDEVICE_NAME='"ESP32-S3 GEEK"'

lib_deps =
    ${env.lib_deps}
